<!DOCTYPE html>
<html lang="en">
<head>
	<title>mini-shop</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--===============================================================================================-->	
	<link rel="icon" type="image/jpg" href="images/bg-01.jpg"/>
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.7.0/css/font-awesome.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="fonts/Linearicons-Free-v1.0.0/icon-font.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animate/animate.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/css-hamburgers/hamburgers.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/animsition/css/animsition.min.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="vendor/select2/select2.min.css">
<!--===============================================================================================-->	
	<link rel="stylesheet" type="text/css" href="vendor/daterangepicker/daterangepicker.css">
<!--===============================================================================================-->
	<link rel="stylesheet" type="text/css" href="css/util.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
<!--===============================================================================================-->
	<script src="axios/axios.min.js"></script>
	<link rel="stylesheet" href="../../dist/css/adminlte.min.css?v=3.2.0">

	<script src="./../plugins/jquery/jquery.min.js"></script>

	<!-- Select2 -->
	<link rel="stylesheet" href="./../plugins/toastr/toastr.min.css">
  	<script src="./../plugins/toastr/toastr.min.js"></script>
	
	<style>
		h5{
			font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		}
	</style>
</head>
<body style="background-color: #666666;">
	
	<div class="limiter">
		<div class="container-login100">
			<div class="wrap-login100">

				<form  onsubmit= "vali_login(1)" id = 'con1' class="login100-form validate-form " action="vertify" method="post">

					<span class="login100-form-title p-b-43">
						Login to continue
					</span>
					
					<div class="wrap-input100 validate-input" data-validate = " Username is required">
						<input class="input100" type="text" name="username">
						<span class="focus-input100"></span>
						<span class="label-input100">Username</span>
					</div>
					
					
					<div class="wrap-input100 validate-input" data-validate="Password is required">
						<input class="input100" type="password" name="pwd"  >
						<span class="focus-input100"></span>
						<span class="label-input100">Password</span>
					</div>

					<div >
						<a href="#" onclick="togle_login_mode(1)" class="txt1 float-right mb-2 ">
							First time login ?
						</a>
					</div>

					<div class="container-login100-form-btn">
						<button class="login100-form-btn">
							Login
						</button>
					</div>
					
				</form>

				<form  id = 'con2' onsubmit= "vali_login(2)" class="login100-form validate-form d-none" action="vertify" method="post">

					<span class="login100-form-title p-b-43">
						Enter password
					</span>
					
					
					<div class="wrap-input100 validate-input" data-validate = " Username is required">
						<input class="input100" type="text" name="username1">
						<span class="focus-input100"></span>
						<span class="label-input100">Username</span>
					</div>
					
					
					<div class="wrap-input100 validate-input  " data-validate="Password is required">
						<input class="input100" type="password" name="pwd1"  >
						<span class="focus-input100"></span>
						<span class="label-input100">Password</span>
					</div>
					<div class="wrap-input100 validate-input  " data-validate="Password is required">
						<input class="input100" type="password" name="pwd2"  >
						<span class="focus-input100"></span>
						<span class="label-input100">Enter password again</span>
					</div>

					<div >
						<a href="#" onclick="togle_login_mode(2)" class="txt1 float-right mb-2 ">
							Have Login ?
						</a>
					</div>

					<div class="container-login100-form-btn">
						<button class="login100-form-btn">
							Login
						</button>
					</div>
					
				</form>



				<div class="login100-more" style="background-image: url('images/bg-01.jpg');">
				</div>
                
			</div>
		</div>
	</div>
	
	

	
	
<!--===============================================================================================-->
	<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/bootstrap/js/popper.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/select2/select2.min.js"></script>
<!--===============================================================================================-->
	<script src="vendor/daterangepicker/moment.min.js"></script>
	<script src="vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="vendor/countdowntime/countdowntime.js"></script>
<!--===============================================================================================-->
	<script src="js/main.js"></script>

	<script>
		function togle_login_mode(x){
			if( x === 1){
				$('#con1').addClass('d-none');
				$('#con2').removeClass('d-none');
			}else if( x === 2) {
				$('#con2').addClass('d-none');
				$('#con1').removeClass('d-none');
			}
			$('.validate-form .input100').each(function(input){
				var thisAlert = $(this).parent();
				$(thisAlert).removeClass('alert-validate');
			});
			
		}
		function vali_login(mode){
				
				if(mode === 1){
					let user = $('input[name = username ]').val().trim()
					let pwd = $('input[name = pwd ]').val().trim()
					if(user != "" && pwd != ""){
						console.log("OK m 1");
						sendForm_1(user,pwd);
						// return true;
					}
				}else if(mode === 2){
					let user = $('input[name = username1 ]').val().trim()
					let pwd1 = $('input[name = pwd1 ]').val().trim()
					let pwd2 = $('input[name = pwd2 ]').val().trim()
					if(user != "" && pwd1 != "" && pwd2 != ""){
						console.log("OK m 2");
						sendForm_2(user,pwd1,pwd2);
					}
				}


				// let a = document.querySelector("#con1")
				// a = a.querySelectorAll('.alert-validate')

		}

		function sendForm_1(user,pwd){
			let params =new URLSearchParams();
			params.append('user',user);
			params.append('pwd',pwd);
			axios({
				url:'/vertify_login',
				method:'post',
				data:params,
				timeout:3000
			}).then((result)=>{
				console.log(result.data);
				if( result.data.success){
					toastr.success(result.data.code)
					setTimeout(()=>{
						window.location=result.data.path;
					},300);
				}else{
					toastr.error(result.data.code)
					// $('#alert-error1').text(result.data.code)
				
				}

				// if( result.data.status == 1 ){
				//     window.location="/";
			})
		}

		function sendForm_2(user,pwd1,pwd2){
			if( pwd1.trim() !== pwd2.trim() ){
				toastr.error("Password ไม่ตรงกัน.")
				return ;
			}
			let params =new URLSearchParams();
			params.append('user',user);
			params.append('pwd1',pwd1);
			params.append('pwd2',pwd2);
			axios({
				url:'/vertify_ensure_password',
				method:'post',
				data:params,
				timeout:3000
			}).then((result)=>{
				if( result.data.status == 1 ){
					toastr.success(result.data.code)
					setTimeout(()=>{
						window.location="/";
					},300);
				}else{
					toastr.error(result.data.code)
				}
			})
		}

	</script>


</body>
</html>